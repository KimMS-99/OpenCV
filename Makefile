# í•˜ìœ„ ë””ë ‰í† ë¦¬ ì¤‘ Makefileì´ ìˆëŠ” í´ë”ë¥¼ ìë™ìœ¼ë¡œ ì°¾ìŒ
SUBDIRS := $(shell find . -mindepth 2 -name Makefile -exec dirname {} \;)

# all, cleanì€ ì‹¤ì œ íŒŒì¼ì´ ì•„ë‹Œ ëª…ë ¹ì„ì„ ì„ ì–¸
.PHONY: all clean

# ì „ì²´ ë¹Œë“œ
all:
	@echo "ğŸ”§ ìµœìƒìœ„ Makefile ë¹Œë“œ ì‹œì‘"
	@for dir in $(SUBDIRS); do \
		echo "ğŸ“‚ ë¹Œë“œ ì¤‘: $$dir"; \
		$(MAKE) -C $$dir; \
	done
	@echo "âœ… ì „ì²´ ë¹Œë“œ ì™„ë£Œ!"
	
# ì „ì²´ í´ë¦°
clean:
	@echo "ğŸ”§ í•˜ìœ„ ë””ë ‰í† ë¦¬ í´ë¦° ì‹œì‘"
	@for dir in $(SUBDIRS); do \
		if [ -f $$dir/Makefile ]; then \
			echo "ğŸ§½ Cleaning $$dir..."; \
			$(MAKE) -C $$dir clean; \
		fi \
	done
	@echo "âœ… ì „ì²´ clean ì™„ë£Œ!"

# íŠ¹ì • ë””ë ‰í† ë¦¬ì˜ run íƒ€ê²Ÿ ì‹¤í–‰
# ì´ ê·œì¹™ì€ 'make run_ë””ë ‰í† ë¦¬ëª…_í•˜ìœ„ë””ë ‰í† ë¦¬ëª…' í˜•ì‹ìœ¼ë¡œ í˜¸ì¶œë  ë•Œ ë™ì‘í•©ë‹ˆë‹¤.
# ì˜ˆì‹œ: make run_Ch8_P379
#
# ë™ì‘ ë°©ì‹:
# 1. 'run_' ì ‘ë‘ì‚¬ë¥¼ ì œê±°í•˜ê³ , ë‚˜ë¨¸ì§€ ë¶€ë¶„ì˜ ì–¸ë”ìŠ¤ì½”ì–´('_')ë¥¼ ìŠ¬ë˜ì‹œ('/')ë¡œ ë³€í™˜í•˜ì—¬
#    ì‹¤ì œ ë””ë ‰í† ë¦¬ ê²½ë¡œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ì˜ˆ: 'Ch8_P379' -> 'Ch8/P379')
# 2. í•´ë‹¹ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•˜ì—¬ (make -C [ë””ë ‰í† ë¦¬ ê²½ë¡œ])
# 3. í•´ë‹¹ ë””ë ‰í† ë¦¬ì˜ Makefileì— ì •ì˜ëœ 'run' íƒ€ê²Ÿì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
run_%:
	@echo "ğŸš€ Running in $(subst _,/,$(subst run_,,$@))..."
	$(MAKE) -C $(subst _,/,$(subst run_,,$@)) run